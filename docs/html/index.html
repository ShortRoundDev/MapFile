<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MapFile.dll: MapFile.dll</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MapFile_dll.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MapFile.dll
   </div>
   <div id="projectbrief">.map file parser</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MapFile.dll </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
What is this</h1>
<p>MapFile.dll is a Windows library for parsing through .map files created by CSG editors like <a href="https://trenchbroom.github.io/">Trenchbroom</a>. It deserializes the text of the file into a set of C structs which can be used to generate actual world geometry meshes or serve as tokens for creating entities.</p>
<h1><a class="anchor" id="use_sec"></a>
What's the use case?</h1>
<ol type="1">
<li>For those who don't want to re-invent the wheel by developing their own CSG editors for their own custom engine, but also don't want to implement the specificities of a .bsp file</li>
<li>For those who don't like their current engine's CSG editors (such as Unity) and are more familiar with the quake/valve world of editors</li>
</ol>
<h1><a class="anchor" id="map_sec"></a>
What does a .map file look like</h1>
<p>This</p>
<div class="fragment"><div class="line"><span class="comment">// Game: Generic</span></div>
<div class="line"><span class="comment">// Format: Standard</span></div>
<div class="line"><span class="comment">// entity 0</span></div>
<div class="line">{</div>
<div class="line"><span class="stringliteral">&quot;classname&quot;</span> <span class="stringliteral">&quot;worldspawn&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;_tb_textures&quot;</span> <span class="stringliteral">&quot;textures&quot;</span></div>
<div class="line"><span class="comment">// brush 0</span></div>
<div class="line">{</div>
<div class="line">( -64 -64 -16 ) ( -64 -63 -16 ) ( -64 -64 -15 ) __TB_empty 0 0 0 1 1</div>
<div class="line">( -64 -64 -16 ) ( -64 -64 -15 ) ( -63 -64 -16 ) __TB_empty 0 0 0 1 1</div>
<div class="line">( -64 -64 -16 ) ( -63 -64 -16 ) ( -64 -63 -16 ) __TB_empty 0 0 0 1 1</div>
<div class="line">( 64 64 16 ) ( 64 65 16 ) ( 65 64 16 ) __TB_empty 0 0 0 1 1</div>
<div class="line">( 64 64 16 ) ( 65 64 16 ) ( 64 64 17 ) __TB_empty 0 0 0 1 1</div>
<div class="line">( 64 64 16 ) ( 64 64 17 ) ( 64 65 16 ) __TB_empty 0 0 0 1 1</div>
<div class="line">}</div>
<div class="line"><span class="comment">// brush 1</span></div>
<div class="line">{</div>
<div class="line">( -16 -48 80 ) ( -16 32 16 ) ( -16 32 80 ) __TB_empty 0.25 0.5 33.5 2.3 4.6</div>
<div class="line">( 16 -48 80 ) ( -16 -48 16 ) ( -16 -48 80 ) __TB_empty 0.25 0.5 33.5 2.3 4.6</div>
<div class="line">( 16 32 16 ) ( -16 -48 16 ) ( 16 -48 16 ) __TB_empty 0.25 0.5 33.5 2.3 4.6</div>
<div class="line">( 16 32 80 ) ( -16 -48 80 ) ( -16 32 80 ) __TB_empty 0.25 0.5 33.5 2.3 4.6</div>
<div class="line">( 16 32 80 ) ( -16 32 16 ) ( 16 32 16 ) __TB_empty 0.25 0.5 33.5 2.3 4.6</div>
<div class="line">( 16 32 80 ) ( 16 -48 16 ) ( 16 -48 80 ) __TB_empty 0.25 0.5 33.5 2.3 4.6</div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line"><span class="comment">// entity 1</span></div>
<div class="line">{</div>
<div class="line"><span class="stringliteral">&quot;classname&quot;</span> <span class="stringliteral">&quot;info_player_start&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;origin&quot;</span> <span class="stringliteral">&quot;-48 0 40&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;customKey&quot;</span> <span class="stringliteral">&quot;1234565&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Everything in a map file is an entity of some kind (a dictionary of string-string key value pairs), but some entities have brushes in them, which are bounding planes which define the faces of each brush as well as the texture information for each face</p>
<p>If a map needs some kind of global variable, it's just a singleton entity with attributes on it (water_lod_control in Source engine, for example)</p>
<h1><a class="anchor" id="installation_sec"></a>
Installation</h1>
<p>Todo Upon release</p>
<h1><a class="anchor" id="usage_sec"></a>
Usage</h1>
<p>MapFile currently can parse brush information into structs. As an example of that, check out the example in HelloMapFile: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;MapFile.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// runs MF_Parse and prints the first attribute of the first entity,</span></div>
<div class="line"><span class="comment">// or the error code, if there is an error </span></div>
<div class="line"><span class="keywordtype">void</span> parse_and_print(<span class="keywordtype">char</span>* text);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="_map_file___system_8h.html#a9761c38381188367a64c6ae23ff482c3">MF_Init</a>();</div>
<div class="line"> </div>
<div class="line">    parse_and_print(<span class="stringliteral">&quot;\&quot;classname\&quot; \&quot;entity\&quot;}&quot;</span>);  <span class="comment">// missing opening bracket; should print error</span></div>
<div class="line">    parse_and_print(<span class="stringliteral">&quot;{\&quot;classname\&quot; \&quot;entity\&quot;}&quot;</span>); <span class="comment">// correct format</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> parse_and_print(<span class="keywordtype">char</span>* text)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="struct_m_f___map.html">MF_Map_t</a> map;</div>
<div class="line">    BOOL success = <a class="code" href="_map_file___parse_8h.html#a25614040ca43b51ba248c43169799f82">MF_Parse</a>(text, &amp;map);</div>
<div class="line">    <span class="keywordflow">if</span> (success) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Success!\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Total Entities: %zu\n&quot;</span>, map.<a class="code" href="struct_m_f___map.html#a996e05beb6ee2485e4e2325aa1cc63d8">totalItems</a>);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_m_f___key_value_pair.html">MF_KeyValuePair_t</a> attr1 = map.<a class="code" href="struct_m_f___map.html#ad3468b29bfaa7e6285352701efa6d556">items</a>[0].<a class="code" href="struct_m_f___entity.html#aaf5ddfdbf448e66be76d6adb62698339">attributes</a>[0];</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Entity #1 attribute: %s = %s\n\n&quot;</span>, attr1.<a class="code" href="struct_m_f___key_value_pair.html#a742108ef67b81a367c2a118a2348f24e">key</a>, attr1.<a class="code" href="struct_m_f___key_value_pair.html#aac08c8ff3295c5358a2caa043f41d4b3">value</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Failure!\n&quot;</span>);</div>
<div class="line">        <span class="keywordtype">int</span> error_code = <a class="code" href="_map_file___system_8h.html#a995761fddf8c83209b127eec12fbb66d">MF_GetErrCode</a>();</div>
<div class="line">        <span class="keywordtype">char</span> buffer[1024] = { 0 };</div>
<div class="line">        <a class="code" href="_map_file___system_8h.html#aff44834d28567780c05603d671fc27e8">MF_GetErrMessage</a>(buffer);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error [0x%x]: %s\n\n&quot;</span>, error_code, buffer);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="_map_file___system_8h.html#a50fd6e6fcb546db3388ed10c9f3b5034">MF_ResetErr</a>();</div>
<div class="line">}</div>
<div class="ttc" id="a_map_file___parse_8h_html_a25614040ca43b51ba248c43169799f82"><div class="ttname"><a href="_map_file___parse_8h.html#a25614040ca43b51ba248c43169799f82">MF_Parse</a></div><div class="ttdeci">BOOL MF_Parse(char *text, struct MF_Map *map)</div><div class="ttdoc">Parses the text of a mapfile into its relevant MF_Map structs. This runs allocations every step of th...</div><div class="ttdef"><b>Definition:</b> MapFile_Parse.cpp:11</div></div>
<div class="ttc" id="a_map_file___system_8h_html_a50fd6e6fcb546db3388ed10c9f3b5034"><div class="ttname"><a href="_map_file___system_8h.html#a50fd6e6fcb546db3388ed10c9f3b5034">MF_ResetErr</a></div><div class="ttdeci">void MF_ResetErr()</div><div class="ttdoc">Resets MapFile Error code to 0 and the MapFile Error message to an empty string. This is called at th...</div><div class="ttdef"><b>Definition:</b> MapFile_System.cpp:32</div></div>
<div class="ttc" id="a_map_file___system_8h_html_a9761c38381188367a64c6ae23ff482c3"><div class="ttname"><a href="_map_file___system_8h.html#a9761c38381188367a64c6ae23ff482c3">MF_Init</a></div><div class="ttdeci">void MF_Init()</div><div class="ttdoc">Initializes MapFile.dll. Sets the global allocator to malloc and the global deallocator to free.</div><div class="ttdef"><b>Definition:</b> MapFile_System.cpp:10</div></div>
<div class="ttc" id="a_map_file___system_8h_html_a995761fddf8c83209b127eec12fbb66d"><div class="ttname"><a href="_map_file___system_8h.html#a995761fddf8c83209b127eec12fbb66d">MF_GetErrCode</a></div><div class="ttdeci">uint32_t MF_GetErrCode()</div><div class="ttdoc">Returns the current error code for MapFile.</div><div class="ttdef"><b>Definition:</b> MapFile_System.cpp:38</div></div>
<div class="ttc" id="a_map_file___system_8h_html_aff44834d28567780c05603d671fc27e8"><div class="ttname"><a href="_map_file___system_8h.html#aff44834d28567780c05603d671fc27e8">MF_GetErrMessage</a></div><div class="ttdeci">void MF_GetErrMessage(_Out_writes_(1024) char *buffer)</div><div class="ttdoc">Copies the current MapFile error message to the provided buffer. The buffer must be 1024 bytes.</div><div class="ttdef"><b>Definition:</b> MapFile_System.cpp:43</div></div>
<div class="ttc" id="astruct_m_f___entity_html_aaf5ddfdbf448e66be76d6adb62698339"><div class="ttname"><a href="struct_m_f___entity.html#aaf5ddfdbf448e66be76d6adb62698339">MF_Entity::attributes</a></div><div class="ttdeci">struct MF_KeyValuePair * attributes</div><div class="ttdoc">A contiguous set of key value pairs in memory.</div><div class="ttdef"><b>Definition:</b> MapFile_Types.h:108</div></div>
<div class="ttc" id="astruct_m_f___key_value_pair_html"><div class="ttname"><a href="struct_m_f___key_value_pair.html">MF_KeyValuePair</a></div><div class="ttdoc">An attribute in the entity definition. Both Key and Value are allocated with MF_Alloc,...</div><div class="ttdef"><b>Definition:</b> MapFile_Types.h:79</div></div>
<div class="ttc" id="astruct_m_f___key_value_pair_html_a742108ef67b81a367c2a118a2348f24e"><div class="ttname"><a href="struct_m_f___key_value_pair.html#a742108ef67b81a367c2a118a2348f24e">MF_KeyValuePair::key</a></div><div class="ttdeci">char * key</div><div class="ttdoc">The key of the attribute.</div><div class="ttdef"><b>Definition:</b> MapFile_Types.h:81</div></div>
<div class="ttc" id="astruct_m_f___key_value_pair_html_aac08c8ff3295c5358a2caa043f41d4b3"><div class="ttname"><a href="struct_m_f___key_value_pair.html#aac08c8ff3295c5358a2caa043f41d4b3">MF_KeyValuePair::value</a></div><div class="ttdeci">char * value</div><div class="ttdoc">The value of the attribute.</div><div class="ttdef"><b>Definition:</b> MapFile_Types.h:83</div></div>
<div class="ttc" id="astruct_m_f___map_html"><div class="ttname"><a href="struct_m_f___map.html">MF_Map</a></div><div class="ttdoc">The main map struct.</div><div class="ttdef"><b>Definition:</b> MapFile_Types.h:116</div></div>
<div class="ttc" id="astruct_m_f___map_html_a996e05beb6ee2485e4e2325aa1cc63d8"><div class="ttname"><a href="struct_m_f___map.html#a996e05beb6ee2485e4e2325aa1cc63d8">MF_Map::totalItems</a></div><div class="ttdeci">size_t totalItems</div><div class="ttdoc">The total number of entities in the items pointer.</div><div class="ttdef"><b>Definition:</b> MapFile_Types.h:118</div></div>
<div class="ttc" id="astruct_m_f___map_html_ad3468b29bfaa7e6285352701efa6d556"><div class="ttname"><a href="struct_m_f___map.html#ad3468b29bfaa7e6285352701efa6d556">MF_Map::items</a></div><div class="ttdeci">struct MF_Entity * items</div><div class="ttdoc">A contiguous set of entities in memory.</div><div class="ttdef"><b>Definition:</b> MapFile_Types.h:120</div></div>
</div><!-- fragment --><p>This will print the following : </p><div class="fragment"><div class="line">Failure!</div>
<div class="line">Error[0x2000001]: No entities in map file counted</div>
<div class="line"> </div>
<div class="line">Success!</div>
<div class="line">Total Entities : 1</div>
<div class="line">Entity #1 attribute: classname = entity</div>
</div><!-- fragment --><h1><a class="anchor" id="roadmap_sec"></a>
Roadmap / What's next</h1>
<ol type="1">
<li>Implement <a class="el" href="struct_m_f___map.html" title="The main map struct.">MF_Map</a> destructor.</li>
<li>Add the geometry functions required to create a point cloud or mesh from the intersections of the brushes</li>
<li>Add C# Bindings(and other bindings if anyone wants them) </li>
</ol>
<h1><a class="anchor" id="faq_sec"></a>
FAQ</h1>
<blockquote class="doxtable">
<p>Why not just export a wavefront.obj file ? </p>
</blockquote>
<p>You can do that for geometry, but it doesn't include entity information</p>
<blockquote class="doxtable">
<p>I'm an unreal user; why shouldn't I just use <a href="https://nte.itch.io/hammuer">HAMMUER</a>? </p>
</blockquote>
<p>You probably should! That can convert compiled BSPsand, as far as I know, includes light computations as well. Additionally, it's not just a dll file that you need to implement functionality for yourself: it's a full software package which does the importing for you. Howevever, it's $42, and MapFile.dll is free. Also, MapFile.dll is MIT licensed so if you need to modify it in some way, you can </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
